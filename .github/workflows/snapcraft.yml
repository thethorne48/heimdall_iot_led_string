name: CI

on: [push]

jobs:
  build:
    container: cibuilds/snapcraft:stable
    name: Build on node ${{ matrix.node_version }} and ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        node_version: [ 12 ]
        os: [ ubuntu-latest ]    
    steps:
    - uses: actions/checkout@v1
    - name: Build with snapcraft
      run: |
        snapcraft
        mkdir snap_build
        mv *.snap snap_build

  publish:
    container: cibuilds/snapcraft:stable
    runs-on: ubuntu-latest
    needs: build
    steps:
    - uses: actions/checkout@v1
    - uses: actions/upload-artifact@master
      with:
        name: heimdall-ledstring.snap
        path: snap_build
    - name: Publish with snapcraft
      env:
        SNAPCRAFT_LOGIN_FILE: ${{ secrets.SNAPCRAFT_LOGIN_FILE }}
      run: |
        mkdir .snapcraft
        echo $SNAPCRAFT_LOGIN_FILE | base64 --decode --ignore-garbage > .snapcraft/snapcraft.cfg
        snapcraft push *.snap --release stable

